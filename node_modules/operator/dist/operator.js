var n=require("matchit"),t=new Map;function e(n){return n.replace(window.location.origin,"")}function r(t,e){var r="",a="",o=t.split(/#|\?/),i=o[0],c=o.slice(1);i=(i=i.replace(/\/$/g,""))||"/";for(var u=0;u<c.length;u++){var l=t.split(c[u])[0];"?"===l[l.length-1]&&(a=c[u]),"#"===l[l.length-1]&&(r=c[u])}var f=n.match(i,e.map(function(n){return n.matcher})),h=e.filter(function(n){return n.path===f[0].old})[0];return f[0]?Object.assign({},h,{params:n.exec(i,f),hash:r,search:a,pathname:i,location:t}):null}module.exports=function(a,o){void 0===o&&(o=["*"]);var i,c=document.querySelector(a),u=[],l={};o=o.concat(o.indexOf("*")<0?"*":[]).reduce(function(n,t){return"function"==typeof t?(u.push(t),n):n.concat(t)},[]).map(function(t){return t.path?Object.assign({},t,{matcher:n.parse(t.path)}):{path:t,matcher:n.parse(t)}});var f=r(e(window.location.href),o),h=Object.assign({previousDocument:null},f);function s(n){return l[n]?l[n].map(function(n){return n(h)}):[]}function p(n,t,e,r){h.previousDocument=n.cloneNode(!0),Promise.all(u.concat(e.handler||[]).map(function(n){return n(h)})).then(function(){requestAnimationFrame(function(){c.innerHTML=t,s("after"),e.hash&&s("hash")})})}function d(n,e,r){if(!e)return window.location.href=n;fetch(n,{credentials:"include"}).then(function(n){return n.text()}).then(function(o){var i=(new window.DOMParser).parseFromString(o,"text/html"),c=[i,i.querySelector(a).innerHTML];t.set(n,c),r&&r(c[0],c[1],e)})}function m(n,e,r){i=function(){var r=t.get(n);r&&!1!==e.cache?p(r[0],r[1],e):d(n,e,p)},Object.assign(h,e),Promise.all(s("before")).then(i)}function v(n){var t=e(n);return[t,r(t,o)]}return document.body.addEventListener("click",function(n){if(!(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.defaultPrevented)){for(var t=n.target;t&&(!t.href||"A"!==t.nodeName);)t=t.parentNode;if(!t)return n;var e=v(t.href),r=e[0],a=e[1];return a.ignore?n:h.pathname===a.pathname&&a.hash?(n.preventDefault(),Object.assign(h,a),s("hash"),n):window.location.origin!==t.origin||t.hasAttribute("download")||"_blank"===t.target||/^(?:mailto|tel):/.test(t.href)||t.classList.contains("no-ajax")?n:(n.preventDefault(),h.location!==r&&m(r,a),s("navigate"),!1)}}),window.addEventListener("popstate",function(n){if(n.target.location.pathname!==h.pathname)return m.apply(void 0,v(n.target.location.href).concat([!0])),!1}),{get state(){return h},go:function(n){i=null,m.apply(void 0,v(n).concat([!1]))},load:function(n,t){return d.apply(void 0,v(n).concat([t]))},on:function(n,t){return l[n]=l[n]?l[n].concat(t):[t],function(){return l[n].slice(l[n].indexOf(t),1)}}}};
//# sourceMappingURL=operator.js.map
