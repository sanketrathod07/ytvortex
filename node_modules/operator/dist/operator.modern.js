import{parse as t,exec as e,match as n}from"matchit";const a=new Map;function o(t){return t.replace(window.location.origin,"")}function r(t,a){let o="",r="",[i,...c]=t.split(/#|\?/);i=i.replace(/\/$/g,""),i=i||"/";for(let e=0;e<c.length;e++){const[n]=t.split(c[e]);"?"===n[n.length-1]&&(r=c[e]),"#"===n[n.length-1]&&(o=c[e])}const l=n(i,a.map(t=>t.matcher)),s=a.filter(t=>t.path===l[0].old)[0];return l[0]?Object.assign({},s,{params:e(i,l),hash:o,search:r,pathname:i,location:t}):null}export default function(e,n=["*"]){let i,c=document.querySelector(e);const l=[],s={};n=n.concat(n.indexOf("*")<0?"*":[]).reduce((t,e)=>"function"==typeof e?(l.push(e),t):t.concat(e),[]).map(e=>e.path?Object.assign({},e,{matcher:t(e.path)}):{path:e,matcher:t(e)});const h=r(o(window.location.href),n);let u=Object.assign({previousDocument:null},h);function f(t){return s[t]?s[t].map(t=>t(u)):[]}function p(t,e,n,a){u.previousDocument=t.cloneNode(!0),Promise.all(l.concat(n.handler||[]).map(t=>t(u))).then(()=>{requestAnimationFrame(()=>{c.innerHTML=e,f("after"),n.hash&&f("hash")})})}function d(t,n,o){if(!n)return window.location.href=t;fetch(t,{credentials:"include"}).then(t=>t.text()).then(r=>{const i=(new window.DOMParser).parseFromString(r,"text/html"),c=[i,i.querySelector(e).innerHTML];a.set(t,c),o&&o(c[0],c[1],n)})}function m(t,e,n){i=()=>{const n=a.get(t);n&&!1!==e.cache?p(n[0],n[1],e):d(t,e,p)},Object.assign(u,e),Promise.all(f("before")).then(i)}function g(t){const e=o(t);return[e,r(e,n)]}return document.body.addEventListener("click",t=>{if(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.defaultPrevented)return;let e=t.target;for(;e&&(!e.href||"A"!==e.nodeName);)e=e.parentNode;if(!e)return t;const[n,a]=g(e.href);return a.ignore?t:u.pathname===a.pathname&&a.hash?(t.preventDefault(),Object.assign(u,a),f("hash"),t):window.location.origin!==e.origin||e.hasAttribute("download")||"_blank"===e.target||/^(?:mailto|tel):/.test(e.href)||e.classList.contains("no-ajax")?t:(t.preventDefault(),u.location!==n&&m(n,a),f("navigate"),!1)}),window.addEventListener("popstate",t=>{if(t.target.location.pathname!==u.pathname)return m(...g(t.target.location.href),!0),!1}),{get state(){return u},go(t){i=null,m(...g(t),!1)},load:(t,e)=>d(...g(t),e),on:(t,e)=>(s[t]=s[t]?s[t].concat(e):[e],()=>s[t].slice(s[t].indexOf(e),1))}}
//# sourceMappingURL=operator.modern.js.map
