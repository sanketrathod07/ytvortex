import{parse as n,exec as t,match as e}from"matchit";var r=new Map;function a(n){return n.replace(window.location.origin,"")}function o(n,r){var a="",o="",i=n.split(/#|\?/),c=i[0],u=i.slice(1);c=(c=c.replace(/\/$/g,""))||"/";for(var l=0;l<u.length;l++){var f=n.split(u[l])[0];"?"===f[f.length-1]&&(o=u[l]),"#"===f[f.length-1]&&(a=u[l])}var h=e(c,r.map(function(n){return n.matcher})),s=r.filter(function(n){return n.path===h[0].old})[0];return h[0]?Object.assign({},s,{params:t(c,h),hash:a,search:o,pathname:c,location:n}):null}export default function(t,e){void 0===e&&(e=["*"]);var i,c=document.querySelector(t),u=[],l={};e=e.concat(e.indexOf("*")<0?"*":[]).reduce(function(n,t){return"function"==typeof t?(u.push(t),n):n.concat(t)},[]).map(function(t){return t.path?Object.assign({},t,{matcher:n(t.path)}):{path:t,matcher:n(t)}});var f=o(a(window.location.href),e),h=Object.assign({previousDocument:null},f);function s(n){return l[n]?l[n].map(function(n){return n(h)}):[]}function p(n,t,e,r){h.previousDocument=n.cloneNode(!0),Promise.all(u.concat(e.handler||[]).map(function(n){return n(h)})).then(function(){requestAnimationFrame(function(){c.innerHTML=t,s("after"),e.hash&&s("hash")})})}function d(n,e,a){if(!e)return window.location.href=n;fetch(n,{credentials:"include"}).then(function(n){return n.text()}).then(function(o){var i=(new window.DOMParser).parseFromString(o,"text/html"),c=[i,i.querySelector(t).innerHTML];r.set(n,c),a&&a(c[0],c[1],e)})}function m(n,t,e){i=function(){var e=r.get(n);e&&!1!==t.cache?p(e[0],e[1],t):d(n,t,p)},Object.assign(h,t),Promise.all(s("before")).then(i)}function v(n){var t=a(n);return[t,o(t,e)]}return document.body.addEventListener("click",function(n){if(!(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.defaultPrevented)){for(var t=n.target;t&&(!t.href||"A"!==t.nodeName);)t=t.parentNode;if(!t)return n;var e=v(t.href),r=e[0],a=e[1];return a.ignore?n:h.pathname===a.pathname&&a.hash?(n.preventDefault(),Object.assign(h,a),s("hash"),n):window.location.origin!==t.origin||t.hasAttribute("download")||"_blank"===t.target||/^(?:mailto|tel):/.test(t.href)||t.classList.contains("no-ajax")?n:(n.preventDefault(),h.location!==r&&m(r,a),s("navigate"),!1)}}),window.addEventListener("popstate",function(n){if(n.target.location.pathname!==h.pathname)return m.apply(void 0,v(n.target.location.href).concat([!0])),!1}),{get state(){return h},go:function(n){i=null,m.apply(void 0,v(n).concat([!1]))},load:function(n,t){return d.apply(void 0,v(n).concat([t]))},on:function(n,t){return l[n]=l[n]?l[n].concat(t):[t],function(){return l[n].slice(l[n].indexOf(t),1)}}}}
//# sourceMappingURL=operator.es.js.map
